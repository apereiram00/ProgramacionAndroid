rules_version = '2';
service cloud.firestore {
    match /databases/{database}/documents {
        match /usuarios/{userId} {
            // Permitir leer todos los usuarios para usuarios autenticados
            allow read: if request.auth != null;
            // Permitir escribir (incluyendo borrar) solo al propietario del documento o en el contexto de borrado de cuenta
            allow write: if (request.auth != null && request.auth.uid == userId)
                || (request.resource == null && resource.data != null && resource.data.keys().hasAll(['usuarioId']) && resource.data.usuarioId == userId);
        }
    }
}